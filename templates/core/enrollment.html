{% extends 'base.html' %}

{% block title %}Enroll Participant - Clinical Study Manager{% endblock %}

{% block page_title %}Enroll New Participant{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h5 class="card-title mb-0">
                    <i class="fas fa-user-plus"></i> Participant Information
                </h5>
            </div>
            <div class="card-body">
                <form method="post" id="enrollmentForm">
                    {% csrf_token %}
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="participant_id" class="form-label">Participant ID *</label>
                            <input type="text" class="form-control" id="participant_id" name="participant_id" required>
                            <div class="form-text">Auto-generated participant identifier</div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="enrollment_date" class="form-label">Enrollment Date *</label>
                            <input type="datetime-local" class="form-control" id="enrollment_date" name="enrollment_date" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="first_name" class="form-label">First Name *</label>
                            <input type="text" class="form-control" id="first_name" name="first_name" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="last_name" class="form-label">Last Name *</label>
                            <input type="text" class="form-control" id="last_name" name="last_name" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="date_of_birth" class="form-label">Date of Birth *</label>
                            <input type="date" class="form-control" id="date_of_birth" name="date_of_birth" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="gender" class="form-label">Gender *</label>
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="">Select Gender</option>
                                <option value="M">Male</option>
                                <option value="F">Female</option>
                                <option value="O">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="contact_info" class="form-label">Contact Information *</label>
                        <input type="text" class="form-control" id="contact_info" name="contact_info" required>
                        <div class="form-text">Phone number or email address</div>
                    </div>

                    <div class="mb-3">
                        <label for="emergency_contact" class="form-label">Emergency Contact</label>
                        <input type="text" class="form-control" id="emergency_contact" name="emergency_contact">
                    </div>

                    <div class="mb-3">
                        <label for="medical_history" class="form-label">Initial Medical Notes</label>
                        <textarea class="form-control" id="medical_history" name="medical_history" rows="3"></textarea>
                    </div>

                    <div class="alert alert-info">
                        <h6><i class="fas fa-info-circle"></i> Important</h6>
                        <p class="mb-0">After enrollment, the participant will proceed to the vitals station for baseline measurements.</p>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <a href="{% url 'core:dashboard' %}" class="btn btn-secondary me-md-2">Cancel</a>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save"></i> Enroll Participant
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
$(document).ready(function() {
    // Auto-generate participant ID
    function generateParticipantId() {
        const timestamp = new Date().getTime();
        const random = Math.floor(Math.random() * 1000);
        return `ENR-${timestamp.toString().slice(-6)}-${random.toString().padStart(3, '0')}`;
    }

    $('#participant_id').val(generateParticipantId());
    
    // Set current date/time for enrollment
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    $('#enrollment_date').val(now.toISOString().slice(0, 16));
});
</script>
{% endblock %}